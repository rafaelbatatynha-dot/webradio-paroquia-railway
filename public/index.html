<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebR√°dio Par√≥quia Nossa Senhora Auxiliadora ‚Äì Ira√≠/RS</title>
    <meta name="description" content="Ou√ßa a WebR√°dio da Par√≥quia Nossa Senhora Auxiliadora de Ira√≠/RS. Programa√ß√£o cat√≥lica, mensagens do C√¥nego Rafael e m√∫sica cl√°ssica.">
    <meta name="keywords" content="WebR√°dio, Par√≥quia, Nossa Senhora Auxiliadora, Ira√≠, RS, Igreja Cat√≥lica, C√¥nego Rafael, Missa, M√∫sica Cl√°ssica, R√°dio Cat√≥lica">
    <meta name="author" content="Par√≥quia Nossa Senhora Auxiliadora">
    <link rel="canonical" href="https://www.paroquiaauxiliadorairai.com.br">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.paroquiaauxiliadorairai.com.br">
    <meta property="og:title" content="WebR√°dio Par√≥quia Nossa Senhora Auxiliadora ‚Äì Ira√≠/RS">
    <meta property="og:description" content="Ou√ßa a WebR√°dio da Par√≥quia Nossa Senhora Auxiliadora de Ira√≠/RS. Programa√ß√£o cat√≥lica, mensagens do C√¥nego Rafael e m√∫sica cl√°ssica.">
    <meta property="og:image" content="https://www.paroquiaauxiliadorairai.com.br/images/og-image.jpg"> <!-- Substitua pela URL da sua imagem -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.paroquiaauxiliadorairai.com.br">
    <meta property="twitter:title" content="WebR√°dio Par√≥quia Nossa Senhora Auxiliadora ‚Äì Ira√≠/RS">
    <meta property="twitter:description" content="Ou√ßa a WebR√°dio da Par√≥quia Nossa Senhora Auxiliadora de Ira√≠/RS. Programa√ß√£o cat√≥lica, mensagens do C√¥nego Rafael e m√∫sica cl√°ssica.">
    <meta property="twitter:image" content="https://www.paroquiaauxiliadorairai.com.br/images/twitter-image.jpg"> <!-- Substitua pela URL da sua imagem -->

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Tailwind CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font Awesome para √≠cones (CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: #333;
        }
        .radio-container {
            background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
            border: 1px solid #e0e0e0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .play-button, .pause-button {
            background-color: #4CAF50; /* Verde */
            transition: all 0.3s ease;
        }
        .play-button:hover, .pause-button:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        .play-button:active, .pause-button:active {
            transform: scale(0.95);
        }
        .play-button:disabled, .pause-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: scale(1);
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border: none;
        }
        .message-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .message-overlay.active {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center py-20 px-4">
    <!-- Container do Player -->
    <div class="radio-container bg-white rounded-2xl shadow-2xl p-8 sm:p-12 text-center max-w-xl w-full">
        <h1 class="text-4xl sm:text-5xl font-bold mb-6" style="color: #4CAF50;">üéôÔ∏è WebR√°dio Par√≥quia NSA</h1>
        <p class="text-gray-600 mb-8 text-lg">Ou√ßa nossa programa√ß√£o ao vivo</p>

        <!-- Informa√ß√µes do Status -->
        <div class="radio-info mb-8 bg-gray-50 rounded-xl p-6">
            <p class="mb-3 text-lg">
                <span class="font-bold text-gray-700">Status:</span>
                <span id="radio-status" class="font-semibold text-gray-600">Conectando...</span>
            </p>
            <p class="text-lg">
                <span class="font-bold text-gray-700">Tocando:</span>
                <span id="radio-description" class="italic text-gray-500">Carregando programa√ß√£o...</span>
            </p>
        </div>

        <!-- Player de √Åudio (oculto) -->
        <audio id="audio-player" preload="none" crossorigin="anonymous">
            Seu navegador n√£o suporta reprodu√ß√£o de √°udio.
        </audio>

        <!-- Controles do Player -->
        <div class="player-controls flex justify-center gap-6 mb-8">
            <button id="play-button" disabled class="play-button text-white rounded-full w-20 h-20 text-4xl flex items-center justify-center shadow-lg">
                <i class="fas fa-play"></i>
            </button>
            <button id="pause-button" disabled class="pause-button text-white rounded-full w-20 h-20 text-4xl flex items-center justify-center shadow-lg">
                <i class="fas fa-pause"></i>
            </button>
        </div>

        <!-- Controle de Volume -->
        <div class="volume-control flex items-center justify-center gap-4 mb-8">
            <span class="text-xl text-gray-700 font-semibold">üîä Volume:</span>
            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.7" class="w-48 h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer volume-slider">
            <span id="volume-value" class="text-xl text-gray-700 font-semibold w-12">70%</span>
        </div>

        <!-- Contador de Ouvintes -->
        <div class="listeners-count bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-4">
            <p class="text-lg text-gray-700">
                üë• Ouvintes online: <span id="listeners-total" class="font-bold text-2xl" style="color: #4CAF50;">0</span>
            </p>
        </div>
    </div>

    <!-- Overlay para Mensagens Especiais -->
    <div id="message-overlay" class="message-overlay fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-10 text-center shadow-2xl max-w-md mx-4">
            <h2 class="text-3xl font-bold mb-4" style="color: #4CAF50;">‚ú® Mensagem Especial!</h2>
            <p id="message-text" class="text-xl text-gray-700 mb-6">Uma mensagem do C√¥nego Rafael est√° sendo transmitida.</p>
            <button id="close-message-button" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg text-lg font-semibold transition-all duration-300 transform hover:scale-105">
                Entendi
            </button>
        </div>
    </div>

    <!-- Script do Player -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        (function() {
            console.log('Iniciando WebR√°dio Player...');
            console.log('Conectando em: https://webradio-paroquia.onrender.com');

            const socket = io('https://webradio-paroquia.onrender.com', {
                transports: ['websocket', 'polling'],
                reconnection: true,
                reconnectionDelay: 1000,
                reconnectionAttempts: 10,
                path: '/socket.io/'
            });

            const audioPlayer = document.getElementById('audio-player');
            const playButton = document.getElementById('play-button');
            const pauseButton = document.getElementById('pause-button');
            const volumeSlider = document.getElementById('volume-slider');
            const volumeValue = document.getElementById('volume-value');
            const radioStatus = document.getElementById('radio-status');
            const radioDescription = document.getElementById('radio-description');
            const listenersTotal = document.getElementById('listeners-total');
            const messageOverlay = document.getElementById('message-overlay');
            const messageText = document.getElementById('message-text');
            const closeMessageButton = document.getElementById('close-message-button');

            let currentStreamUrl = '';
            let currentStreamDescription = '';
            let isPlayingMessage = false;
            let userInitiatedPlay = false; // Flag para controlar se o usu√°rio clicou em play

            // Configura volume inicial
            audioPlayer.volume = volumeSlider.value;
            volumeValue.textContent = Math.round(volumeSlider.value * 100) + '%';

            // Controle do bot√£o Play
            playButton.addEventListener('click', () => {
                console.log('Play clicado. Stream URL:', currentStreamUrl);
                userInitiatedPlay = true; // Usu√°rio clicou em play
                if (!currentStreamUrl) {
                    radioStatus.textContent = 'Aguardando URL do servidor...';
                    console.log('‚ùå Sem URL do stream ainda');
                    return;
                }
                console.log('Tentando reproduzir:', currentStreamUrl);
                audioPlayer.src = currentStreamUrl;
                audioPlayer.load();
                audioPlayer.play().then(() => {
                    console.log('‚úÖ Reprodu√ß√£o iniciada pelo usu√°rio.');
                    radioStatus.textContent = 'Reproduzindo';
                    playButton.disabled = true;
                    pauseButton.disabled = false;
                }).catch(error => {
                    console.error('‚ùå Erro ao tentar reproduzir (Play Button):', error);
                    radioStatus.textContent = 'Erro ao reproduzir. Tente novamente.';
                    playButton.disabled = false;
                    pauseButton.disabled = true;
                });
            });

            // Controle do bot√£o Pause
            pauseButton.addEventListener('click', () => {
                console.log('Pause clicado.');
                userInitiatedPlay = false; // Usu√°rio pausou
                audioPlayer.pause();
                radioStatus.textContent = 'Pausado';
                playButton.disabled = false;
                pauseButton.disabled = true;
            });

            // Controle do volume
            volumeSlider.addEventListener('input', () => {
                audioPlayer.volume = volumeSlider.value;
                volumeValue.textContent = Math.round(volumeSlider.value * 100) + '%';
            });

            // Eventos do Socket.IO
            socket.on('connect', () => {
                console.log('‚úÖ Conectado ao servidor Socket.IO');
                radioStatus.textContent = 'Conectado';
                socket.emit('check-stream-status'); // Pede o status atual ao conectar
            });

            socket.on('disconnect', () => {
                console.log('‚ùå Desconectado do servidor Socket.IO');
                radioStatus.textContent = 'Desconectado';
                playButton.disabled = false;
                pauseButton.disabled = true;
            });

            socket.on('play-stream', (data) => {
                console.log('üîÑ Recebido comando play-stream:', data);
                currentStreamUrl = data.url;
                currentStreamDescription = data.description;
                radioDescription.textContent = currentStreamDescription;

                if (!isPlayingMessage && userInitiatedPlay) { // S√≥ toca se n√£o estiver em mensagem e o usu√°rio j√° deu play
                    audioPlayer.src = currentStreamUrl;
                    audioPlayer.load();
                    audioPlayer.play().then(() => {
                        radioStatus.textContent = 'Reproduzindo';
                        playButton.disabled = true;
                        pauseButton.disabled = false;
                    }).catch(error => {
                        console.error('‚ùå Erro ao reproduzir stream (Socket.IO):', error);
                        radioStatus.textContent = 'Erro no stream. Tente novamente.';
                        playButton.disabled = false;
                        pauseButton.disabled = true;
                    });
                } else if (!userInitiatedPlay) {
                    radioStatus.textContent = 'Pausado (Clique Play)';
                    playButton.disabled = false;
                    pauseButton.disabled = true;
                }
            });

            socket.on('play-mensagem', (data) => {
                console.log('üì¢ Recebido comando play-mensagem:', data);
                isPlayingMessage = true;
                messageText.textContent = `Uma mensagem do C√¥nego Rafael (${data.nome}) est√° sendo transmitida.`;
                messageOverlay.classList.add('active'); // Mostra o overlay

                audioPlayer.src = data.arquivo;
                audioPlayer.load();
                audioPlayer.play().then(() => {
                    radioStatus.textContent = 'Mensagem Especial';
                    radioDescription.textContent = data.nome;
                    playButton.disabled = true; // Desabilita play/pause durante a mensagem
                    pauseButton.disabled = true;
                }).catch(error => {
                    console.error('‚ùå Erro ao reproduzir mensagem:', error);
                    radioStatus.textContent = 'Erro na mensagem.';
                    messageOverlay.classList.remove('active'); // Esconde o overlay em caso de erro
                    isPlayingMessage = false;
                    socket.emit('check-stream-status'); // Pede para o servidor retornar ao stream principal
                });
            });

            // Evento para fechar o overlay da mensagem (opcional, a mensagem termina sozinha)
            closeMessageButton.addEventListener('click', () => {
                messageOverlay.classList.remove('active');
            });

            // Eventos do √°udio
            audioPlayer.addEventListener('error', (e) => {
                console.error('‚ùå Erro no √°udio:', audioPlayer.error);
                let errorMsg = 'Erro desconhecido';
                if (audioPlayer.error) {
                    const errorCodes = ['', 'Abortado', 'Erro de rede', 'Erro de decodifica√ß√£o', 'Formato n√£o suportado'];
                    errorMsg = errorCodes[audioPlayer.error.code] || 'Erro ' + audioPlayer.error.code;
                }
                radioStatus.textContent = errorMsg;
                playButton.disabled = false;
                pauseButton.disabled = true;
                isPlayingMessage = false; // Garante que a flag seja resetada
                messageOverlay.classList.remove('active'); // Esconde o overlay
                socket.emit('check-stream-status'); // Pede para o servidor retornar ao stream principal
            });

            audioPlayer.addEventListener('canplay', () => {
                console.log('‚úÖ √Åudio pronto');
            });

            audioPlayer.addEventListener('playing', () => {
                console.log('‚ñ∂Ô∏è Reproduzindo');
                if (!isPlayingMessage) { // S√≥ atualiza bot√µes se n√£o for mensagem
                    playButton.disabled = true;
                    pauseButton.disabled = false;
                    radioStatus.textContent = 'Reproduzindo';
                }
            });

            audioPlayer.addEventListener('pause', () => {
                console.log('‚è∏Ô∏è Pausado');
                if (!isPlayingMessage) { // S√≥ atualiza bot√µes se n√£o for mensagem
                    playButton.disabled = false;
                    pauseButton.disabled = true;
                    radioStatus.textContent = 'Pausado';
                }
            });

            audioPlayer.addEventListener('waiting', () => {
                console.log('‚è≥ Buffering...');
                radioStatus.textContent = 'Carregando...';
            });

            // Quando a mensagem termina, o servidor j√° envia um 'play-stream'
            // O player vai reagir a esse 'play-stream' e retomar a r√°dio principal.
            // A flag isPlayingMessage √© resetada pelo servidor.

            console.log('‚úÖ WebR√°dio Player inicializado');
        })();
    </script>
</body>
</html>
